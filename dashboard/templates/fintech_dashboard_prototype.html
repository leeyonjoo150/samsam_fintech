<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>삼삼핀테크 대시보드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Harmony Beige -->
    <!-- Application Structure Plan: 이 SPA는 사용자가 금융 현황을 직관적으로 파악할 수 있도록 대시보드 구조로 설계되었습니다. 상단에는 핵심 성과 지표(KPI)를 배치하여 총자산, 수익률 등 핵심 정보를 빠르게 확인할 수 있습니다. 중앙에는 기간별 필터링이 가능한 '자산 추이' 차트를 두어 시간의 흐름에 따른 변화를 동적으로 탐색하게 하고, 그 옆에는 '포트폴리오 구성' 도넛 차트를 배치해 자산 분배 현황을 시각적으로 보여줍니다. 하단에는 '월별 수입/지출' 비교 차트와 정렬 가능한 '최근 거래 내역' 테이블을 두어 상세 데이터를 심층적으로 분석할 수 있도록 구성했습니다. 이 구조는 사용자가 전체적인 그림을 먼저 파악하고 점차 세부 사항으로 드릴다운하는 자연스러운 정보 탐색 흐름을 유도하기 위해 선택되었습니다. -->
    <!-- Visualization & Content Choices: 
        - 총 자산, 수익률 (정보 제공) -> KPI 카드 -> 핵심 수치를 즉시 인지.
        - 자산 추이 (변화 분석) -> 라인 차트 (Chart.js) -> 기간 필터(1M/6M/1Y)와 상호작용하여 동적인 데이터 변화 탐색. 시간 흐름에 따른 경향 파악에 최적화.
        - 포트폴리오 구성 (비교/구성) -> 도넛 차트 (Chart.js) -> 전체 자산 대비 각 항목의 비율을 직관적으로 비교.
        - 월별 수입/지출 (비교) -> 막대 차트 (Chart.js) -> 두 가지 범주형 데이터를 명확하게 비교 분석.
        - 최근 거래 내역 (탐색) -> HTML 테이블 -> JavaScript 정렬 기능으로 사용자가 원하는 기준에 따라 데이터를 재구성하여 탐색. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #FDFBF7; /* Warm neutral background */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 40vh;
            max-height: 400px;
        }
        .donut-chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: 40vh;
            max-height: 400px;
        }
        .kpi-card {
            background-color: #FFFFFF;
            border: 1px solid #EAE6E1;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .active-filter {
            background-color: #008080 !important; /* Teal for active state */
            color: white !important;
            border-color: #008080 !important;
        }
    </style>
</head>
<body class="text-gray-700">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800">삼삼핀테크 대시보드</h1>
            <p class="text-md text-gray-500 mt-1">팀 프로젝트 데이터를 활용한 통합 분석 대시보드입니다.</p>
        </header>

        <main>
            <!-- KPI Section -->
            <section id="kpi" class="mb-8">
                 <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="kpi-card p-6 rounded-lg shadow-sm">
                        <h3 class="text-sm font-medium text-gray-500">총 자산</h3>
                        <p class="text-3xl font-bold text-gray-800 mt-2" id="total-assets">₩0</p>
                    </div>
                    <div class="kpi-card p-6 rounded-lg shadow-sm">
                        <h3 class="text-sm font-medium text-gray-500">총 수익률</h3>
                        <p class="text-3xl font-bold text-green-600 mt-2" id="total-return-rate">+0.00%</p>
                    </div>
                    <div class="kpi-card p-6 rounded-lg shadow-sm">
                        <h3 class="text-sm font-medium text-gray-500">이번 달 지출</h3>
                        <p class="text-3xl font-bold text-red-600 mt-2" id="monthly-expense">₩0</p>
                    </div>
                    <div class="kpi-card p-6 rounded-lg shadow-sm">
                        <h3 class="text-sm font-medium text-gray-500">이번 달 수입</h3>
                        <p class="text-3xl font-bold text-blue-600 mt-2" id="monthly-income">₩0</p>
                    </div>
                </div>
            </section>

            <!-- Main Charts Section -->
            <section id="main-charts" class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                        <div>
                            <h2 class="text-xl font-bold text-gray-800">자산 추이</h2>
                            <p class="text-sm text-gray-500">기간별 총 자산의 변화 추이를 보여줍니다.</p>
                        </div>
                        <div id="timeframe-filter" class="flex space-x-2 mt-4 sm:mt-0">
                            <button data-period="1M" class="time-filter px-4 py-2 text-sm font-medium border rounded-md hover:bg-gray-100">1개월</button>
                            <button data-period="6M" class="time-filter px-4 py-2 text-sm font-medium border rounded-md hover:bg-gray-100">6개월</button>
                            <button data-period="1Y" class="time-filter px-4 py-2 text-sm font-medium border rounded-md hover:bg-gray-100 active-filter">1년</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="assetTrendChart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                    <h2 class="text-xl font-bold text-gray-800 mb-1">포트폴리오 구성</h2>
                    <p class="text-sm text-gray-500 mb-4">현재 자산의 분배 현황을 보여줍니다.</p>
                    <div class="donut-chart-container">
                        <canvas id="portfolioDoughnutChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Sub Chart & Table Section -->
            <section id="details" class="grid grid-cols-1 lg:grid-cols-5 gap-8 mb-8">
                <div class="lg:col-span-3 bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                    <h2 class="text-xl font-bold text-gray-800 mb-1">월별 수입/지출</h2>
                    <p class="text-sm text-gray-500 mb-4">최근 6개월간의 수입과 지출을 비교합니다.</p>
                    <div class="chart-container h-[45vh] max-h-[450px]">
                        <canvas id="incomeExpenseBarChart"></canvas>
                    </div>
                </div>
                <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                     <h2 class="text-xl font-bold text-gray-800 mb-1">최근 거래 내역</h2>
                     <p class="text-sm text-gray-500 mb-4">가장 최근에 발생한 거래 내역입니다.</p>
                     <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left">
                            <thead class="text-xs text-gray-500 uppercase bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-4 py-3 cursor-pointer" data-sort="date">날짜 ▼</th>
                                    <th scope="col" class="px-4 py-3">내용</th>
                                    <th scope="col" class="px-4 py-3 cursor-pointer" data-sort="amount">금액</th>
                                </tr>
                            </thead>
                            <tbody id="transactions-table-body">
                                <!-- JS로 데이터가 채워집니다. -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- MOCK DATA ---
            // 실제 환경에서는 이 데이터를 Django 템플릿 변수나 API를 통해 받아옵니다.
            const generateDateLabels = (months) => {
                const labels = [];
                let date = new Date();
                date.setMonth(date.getMonth() - months + 1);
                for (let i = 0; i < months; i++) {
                    labels.push(`${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`);
                    date.setMonth(date.getMonth() + 1);
                }
                return labels;
            };

            const assetData = {
                '1M': {
                    labels: Array.from({length: 30}, (_, i) => { let d = new Date(); d.setDate(d.getDate() - 29 + i); return d.toLocaleDateString('ko-KR', {month:'2-digit', day:'2-digit'}); }),
                    data: Array.from({length: 30}, (_, i) => 50000000 + i * 50000 - Math.random() * 3000000)
                },
                '6M': {
                    labels: generateDateLabels(6),
                    data: [48000000, 49500000, 51000000, 50500000, 52000000, 53000000]
                },
                '1Y': {
                    labels: generateDateLabels(12),
                    data: [45000000, 46000000, 45500000, 47000000, 48000000, 49500000, 51000000, 50500000, 52000000, 53000000, 52500000, 54000000]
                }
            };
            
            const portfolioData = {
                labels: ['국내주식', '해외주식', '채권', '현금'],
                data: [45, 30, 15, 10]
            };

            const incomeExpenseData = {
                labels: generateDateLabels(6),
                income: [4000000, 4200000, 4100000, 4500000, 4300000, 4600000],
                expense: [2500000, 2800000, 2600000, 3000000, 2900000, 3200000]
            };

            const transactionsData = [
                { date: '2025-09-09', description: '점심 식사', amount: -15000, type: 'expense' },
                { date: '2025-09-09', description: '월급', amount: 3000000, type: 'income' },
                { date: '2025-09-08', description: '온라인 쇼핑', amount: -120000, type: 'expense' },
                { date: '2025-09-07', description: '주식 매수 (삼성전자)', amount: -500000, type: 'investment' },
                { date: '2025-09-06', description: '커피', amount: -5500, type: 'expense' },
                { date: '2025-09-05', description: '이자 수익', amount: 25000, type: 'income' },
                { date: '2025-09-04', description: '교통비', amount: -50000, type: 'expense' },
            ];

            let currentSort = { key: 'date', order: 'desc' };

            // --- Chart Instances ---
            let assetTrendChart, portfolioDoughnutChart, incomeExpenseBarChart;

            // --- UTILITY FUNCTIONS ---
            const formatCurrency = (value) => new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' }).format(value);

            // --- RENDER FUNCTIONS ---
            const renderKpiCards = () => {
                const latestAssets = assetData['1Y'].data[assetData['1Y'].data.length - 1];
                document.getElementById('total-assets').textContent = formatCurrency(latestAssets);

                const initialAssets = assetData['1Y'].data[0];
                const returnRate = ((latestAssets - initialAssets) / initialAssets) * 100;
                const returnRateEl = document.getElementById('total-return-rate');
                returnRateEl.textContent = `+${returnRate.toFixed(2)}%`;
                returnRateEl.className = `text-3xl font-bold mt-2 ${returnRate >= 0 ? 'text-green-600' : 'text-red-600'}`;

                const currentMonth = new Date().getMonth();
                const monthlyExpense = incomeExpenseData.expense[incomeExpenseData.expense.length-1]
                const monthlyIncome = incomeExpenseData.income[incomeExpenseData.income.length-1]
                document.getElementById('monthly-expense').textContent = formatCurrency(monthlyExpense);
                document.getElementById('monthly-income').textContent = formatCurrency(monthlyIncome);
            };

            const renderAssetTrendChart = (period) => {
                const ctx = document.getElementById('assetTrendChart').getContext('2d');
                const data = assetData[period];

                if (assetTrendChart) {
                    assetTrendChart.destroy();
                }

                assetTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: '총 자산',
                            data: data.data,
                            borderColor: '#008080', // Teal
                            backgroundColor: 'rgba(0, 128, 128, 0.1)',
                            fill: true,
                            tension: 0.3,
                            pointBackgroundColor: '#008080',
                            pointRadius: 3,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false,
                                ticks: {
                                    callback: (value) => `${(value / 1000000).toFixed(0)}백만`
                                }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: (context) => formatCurrency(context.raw)
                                }
                            }
                        }
                    }
                });
            };

            const renderPortfolioDoughnutChart = () => {
                const ctx = document.getElementById('portfolioDoughnutChart').getContext('2d');
                portfolioDoughnutChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: portfolioData.labels,
                        datasets: [{
                            data: portfolioData.data,
                            backgroundColor: ['#008080', '#20B2AA', '#87CEEB', '#F0E68C'],
                            borderColor: '#FFFFFF',
                            borderWidth: 2,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    boxWidth: 12,
                                    padding: 20,
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: (context) => `${context.label}: ${context.raw}%`
                                }
                            }
                        }
                    }
                });
            };

            const renderIncomeExpenseBarChart = () => {
                const ctx = document.getElementById('incomeExpenseBarChart').getContext('2d');
                incomeExpenseBarChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: incomeExpenseData.labels,
                        datasets: [
                            {
                                label: '수입',
                                data: incomeExpenseData.income,
                                backgroundColor: '#87CEEB', // SkyBlue
                                borderRadius: 4,
                            },
                            {
                                label: '지출',
                                data: incomeExpenseData.expense,
                                backgroundColor: '#FFA07A', // LightSalmon
                                borderRadius: 4,
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                             y: {
                                ticks: {
                                    callback: (value) => `${(value / 1000000).toFixed(1)}백만`
                                }
                            }
                        },
                         plugins: {
                            legend: {
                                position: 'top',
                            },
                            tooltip: {
                                callbacks: {
                                    label: (context) => `${context.dataset.label}: ${formatCurrency(context.raw)}`
                                }
                            }
                        }
                    }
                });
            };
            
            const renderTransactionsTable = () => {
                const sortedData = [...transactionsData].sort((a, b) => {
                    const valA = a[currentSort.key];
                    const valB = b[currentSort.key];
                    let comparison = 0;
                    if (valA > valB) {
                        comparison = 1;
                    } else if (valA < valB) {
                        comparison = -1;
                    }
                    return currentSort.order === 'asc' ? comparison : -comparison;
                });

                const tableBody = document.getElementById('transactions-table-body');
                tableBody.innerHTML = '';
                sortedData.slice(0, 5).forEach(tx => {
                    const row = document.createElement('tr');
                    row.className = 'border-b';
                    const amountClass = tx.amount > 0 ? 'text-blue-600' : 'text-red-600';
                    row.innerHTML = `
                        <td class="px-4 py-3">${tx.date}</td>
                        <td class="px-4 py-3">${tx.description}</td>
                        <td class="px-4 py-3 font-medium ${amountClass}">${formatCurrency(tx.amount)}</td>
                    `;
                    tableBody.appendChild(row);
                });
            };

            // --- EVENT LISTENERS ---
            document.getElementById('timeframe-filter').addEventListener('click', (e) => {
                if (e.target.classList.contains('time-filter')) {
                    const period = e.target.dataset.period;
                    document.querySelectorAll('.time-filter').forEach(btn => btn.classList.remove('active-filter'));
                    e.target.classList.add('active-filter');
                    renderAssetTrendChart(period);
                }
            });
            
            document.querySelector('thead').addEventListener('click', (e) => {
                const key = e.target.dataset.sort;
                if (!key) return;

                if (currentSort.key === key) {
                    currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSort.key = key;
                    currentSort.order = 'desc';
                }
                
                document.querySelectorAll('th[data-sort]').forEach(th => {
                    th.textContent = th.textContent.replace(/ [▼▲]/, '');
                });
                e.target.textContent += ` ${currentSort.order === 'desc' ? '▼' : '▲'}`;

                renderTransactionsTable();
            });


            // --- INITIAL LOAD ---
            const initializeDashboard = () => {
                renderKpiCards();
                renderAssetTrendChart('1Y');
                renderPortfolioDoughnutChart();
                renderIncomeExpenseBarChart();
                renderTransactionsTable();
            };

            initializeDashboard();
        });
    </script>
</body>
</html>